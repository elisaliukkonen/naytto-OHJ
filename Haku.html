<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Äännestys sivu</title>
  <link rel="Stylesheet" href="tyyli.css"> 
</head>
<body>
<header>
  <h1>Mikkelin tapahtumat</h1>
  <div id="ylätunniste" class="dropdown">
    <input type="text" placeholder="Hae tapahtumia" id="Haku" class="Haku">    
    <button onclick="Suodatin()" class="dropbtn">Suodata</button>  
    <div id="suodatin" class="dropdown-sisältö">
      <button class="btn active" onclick="filterSelection('all')">Näytä kaikki</button>
      <div class="Filter" style="display:flex;">
        <button class="btn" id="päivä">Päivä</button>
        <input id="päivä-input" type="date" class="date-picker">
        <button class="btn-aika" id="aika-päivä">Aika väli</button>
        <input id="aika-päivä-al" type="time" class="time-picker"> 
        <input id="aika-päivä-lo" type="time" class="time-picker">
      </div>
      <div class="Filter" style="display:flex;">
        <button class="btn" id="viikko">Viikko</button>
        <input id="viikko-input" type="week" class="date-picker">
        <button class="btn-aika" id="aika-viikko">Aika väli</button>
        <input id="aika-vikko-al" type="time" class="time-picker"> 
        <input id="aika-viikko-lo" type="time" class="time-picker">
      </div>
      <div class="Filter" style="display:flex;">
        <button class="btn" id="kuukausi" >Kuukausi</button>
        <input id="kuukausi-input" type="month" class="date-picker">
        <button class="btn-aika" id="aika-kuukausi">Aika väli</button>
        <input id="aika-kuukausi-al" type="time" class="time-picker"> 
        <input id="aika-kuukausi-lo" type="time" class="time-picker">
      </div>
    </div>
  </div>
</header>
<script>
    
function Suodatin() {
    document.getElementById("suodatin").classList.toggle("show");
}

function Suodatettukohta() {
    var input, filter, div, buttons, i, txtValue;
    input = document.getElementById("Haku");
    filter = input.value.toUpperCase();
    div = document.getElementById("suodatin");
    buttons = div.getElementsByTagName("button");
    for (i = 0; i < buttons.length; i++) {
        txtValue = buttons[i].textContent || buttons[i].innerText;
        if (txtValue.toUpperCase().indexOf(filter) > -1) {
            buttons[i].style.display = "";
        } else {
            buttons[i].style.display = "none";
        }
    }
}

document.getElementById("Haku").addEventListener("input", Suodatettukohta);

function filterSelection(filter) {
    var päiväRow = document.getElementById('päivä').closest('.Filter');
    var viikkoRow = document.getElementById('viikko').closest('.Filter');
    var kuukausiRow = document.getElementById('kuukausi').closest('.Filter');

    var dayInput = document.getElementById('päivä-input');
    var weekInput = document.getElementById('viikko-input');
    var monthInput = document.getElementById('kuukausi-input');
    var dayTimeA = document.getElementById('aika-päivä');
    var weekTimeA = document.getElementById('aika-viikko');
    var monthTimeA = document.getElementById('aika-kuukausi');

    var timeInputs = [
      document.getElementById('aika-päivä-al'),
      document.getElementById('aika-päivä-lo'),
      document.getElementById('aika-vikko-al'),
      document.getElementById('aika-viikko-lo'),
      document.getElementById('aika-kuukausi-al'),
      document.getElementById('aika-kuukausi-lo')
    ];

    document.querySelectorAll('#suodatin .btn').forEach(function(b){ b.classList.remove('active'); });

    dayInput.value = '';
    weekInput.value = '';
    monthInput.value = '';
    timeInputs.forEach(i => { if(i) { i.value = ''; i.style.display = 'none'; } });

    dayInput.style.display = 'none';
    weekInput.style.display = 'none';
    monthInput.style.display = 'none';
    [dayTimeA, weekTimeA, monthTimeA].forEach(b => { if(b) b.style.display = 'none'; });

    if (filter === 'all' || filter === 'Näytä kaikki') {
        päiväRow.style.display = 'flex';
        viikkoRow.style.display = 'flex';
        kuukausiRow.style.display = 'flex';
    } else if (filter === 'Päivä') {
        päiväRow.style.display = 'flex';
        viikkoRow.style.display = 'none';
        kuukausiRow.style.display = 'none';
        dayInput.style.display = 'inline-block';
        if (dayTimeA) dayTimeA.style.display = 'inline-block';
    } else if (filter === 'Viikko') {
        päiväRow.style.display = 'none';
        viikkoRow.style.display = 'flex';
        kuukausiRow.style.display = 'none';
        weekInput.style.display = 'inline-block';
        if (weekTimeA) weekTimeA.style.display = 'inline-block';
    } else if (filter === 'Kuukausi') {
        päiväRow.style.display = 'none';
        viikkoRow.style.display = 'none';
        kuukausiRow.style.display = 'flex';
        monthInput.style.display = 'inline-block';
        if (monthTimeA) monthTimeA.style.display = 'inline-block';
    }

    var allTopBtns = Array.from(document.querySelectorAll('#suodatin .btn'));
    var matchText = (filter === 'all') ? 'Näytä kaikki' : filter;
    var matchBtn = allTopBtns.find(b => b.textContent.trim() === matchText);
    if (matchBtn) matchBtn.classList.add('active');
}

function setupAikaToggle(btnId, inputStartId, inputEndId) {
  var btn = document.getElementById(btnId);
  var inA = document.getElementById(inputStartId);
  var inB = document.getElementById(inputEndId);
  if (!btn || !inA || !inB) return;
  btn.addEventListener('click', function(e){
    e.preventDefault();
    var show = inA.style.display !== 'inline-block';
    document.querySelectorAll('.time-picker').forEach(t => t.style.display = 'none');
    inA.style.display = show ? 'inline-block' : 'none';
    inB.style.display = show ? 'inline-block' : 'none';
    if (show) {
      setTimeout(()=>{ try { inA.focus(); } catch(e){} }, 10);
    } else {
      inA.value = ''; inB.value = '';
    }
  });
}

setupAikaToggle('aika-päivä', 'aika-päivä-al', 'aika-päivä-lo');
setupAikaToggle('aika-viikko', 'aika-vikko-al', 'aika-viikko-lo');
setupAikaToggle('aika-kuukausi', 'aika-kuukausi-al', 'aika-kuukausi-lo');

function kalenteri(buttonId, inputId, filterName) {
    const btn = document.getElementById(buttonId);
    const input = document.getElementById(inputId);
    if (!btn || !input) return;

    btn.addEventListener('click', function (e) {
        e.preventDefault();
        const visible = input.style.display === 'inline-block';
        input.style.display = visible ? 'none' : 'inline-block';

        if (typeof filterSelection === 'function') {
            filterSelection(filterName);
        }

        if (!visible) {
            setTimeout(() => {
                try { input.focus(); } catch (err) {}
                if (typeof input.showPicker === 'function') {
                    input.showPicker();
                }
            }, 10);
        }
    });
}

kalenteri('päivä', 'päivä-input', 'Päivä');
kalenteri('viikko', 'viikko-input', 'Viikko');
kalenteri('kuukausi', 'kuukausi-input', 'Kuukausi');
</script>
</body>
</html>
